#include "math2.h"

#ifndef UPDATE
#define UPDATE
typedef struct meshData{
    int vertexCount, triangleCount;
    int *triangleCountPerVertex, *triangleOffset;
    uint3 *trianglesByVertex, *triangles;
    double3 *points1, *points2, *areaForce, *volumeForce;
    double* areas;
} MeshData;

void calculateForces(int vertexIndex, 
                     int threadIndex,
                     MeshData* m);

double calculateAlpha(int vertexCount,
                      double3* areaForce, double3* volumeForce);


void displaceVertices(int vertexIndex, 
                      double alpha, double lambda, 
                      double3* points1, double3* points2, 
                      double3* areaForce,
                      double3* volumeForce);

void calculateAreas(int triangleIndex, uint3* triangles, double3* points2, double* areas);

double sumSurfaceArea(int triangleCount, double* areas);

double iterate(double lambda, MeshData* m);

double findLambda(double lambda, MeshData* m);

double update(double lambda, MeshData* m);

#endif